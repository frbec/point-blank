<template>
  <main>
    <section class="hero">
      <h1>{{ post.fields.title }}</h1>
      <p>{{ post.fields.description }}</p>
      <img :src="post.fields.heroImage.fields.file.url + '?fit=fill&w=500&h=' + vheight"
           :srcset="`${post.fields.heroImage.fields.file.url}?w=500&h=${vheight}&fit=fill 500w,
                    ${post.fields.heroImage.fields.file.url}?w=960&h=${vheight}&fit=fill 960w,
                    ${post.fields.heroImage.fields.file.url}?w=1920&h=${vheight}&fit=fill 1920w`"
           sizes="100vw"
           class="">
    </section>
    <section class="content">
      <div>
        <p>{{ vheight }}</p>
        <vue-markdown>{{ post.fields.body }}</vue-markdown>
      </div>
      <div>
        <!-- put images here -->
      </div>
    </section>
    <footer>Â© Fredrik Beckius 2017</footer>
  </main>
</template>

<script>
  import VueMarkdown from 'vue-markdown'
  import {createClient} from '~/plugins/contentful.js'
  const client = createClient()

  export default {
    // `env` is available in the context object
    asyncData ({ env, params }) {
      return client.getEntries({
        'content_type': env.CTF_PORTFOLIO_ITEM_TYPE_ID,
        'fields.slug': params.slug
      }).then(entries => {
        return {
          post: entries.items[0]
        }
      })
        .catch(console.error)
    },
    components: {
      VueMarkdown
    },
    data: function () {
      let h = (document.getElementsByClassName('hero').offsetHeight || '')
      return {
        'vheight': h
      }
    }
  }
</script>